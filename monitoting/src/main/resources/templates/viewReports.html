<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>View Reports - Green Infrastructure Portal</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .custom-border { border: 1px solid #218838 !important; }
        .card-hover { transition: transform 0.3s, box-shadow 0.3s; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.12); }
        .table thead th { white-space: nowrap; }
    </style>
</head>

<body>
<nav class="navbar navbar-dark bg-success px-3">
    <span class="navbar-brand mb-0 h1">ðŸŒ¿ Green Infrastructure Monitoring Portal</span>
</nav>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold">View Reports</h2>
        <p class="text-muted">All saved environmental monitoring records</p>
    </div>

    <div class="card shadow-sm custom-border ">
        <div class="card-body">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
                <div class="fw-semibold">Reports List</div>

                <!-- client-side search -->
                <div class="input-group" style="max-width: 320px;">
                    <span class="input-group-text">ðŸ”Ž</span>
                    <input id="searchInput" type="text" class="form-control" placeholder="Search report...">
                </div>
            </div>

            <div class="table-responsive">
                <table id="reportsTable" class="table table-bordered table-hover align-middle mb-0">
                    <thead class="table-success">
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Location</th>
                        <th>Notes</th>
                    </tr>
                    </thead>

                    <tbody>
                    <!-- If no reports -->
                    <tr th:if="${#lists.isEmpty(reports)}">
                        <td colspan="5" class="text-center text-muted py-4">
                            No reports found.
                        </td>
                    </tr>

                    <!-- Reports rows -->
                    <tr th:each="r : ${reports}">
                        <td th:text="${r.id}">1</td>
                        <td th:text="${r.reportDate}">2026-02-11</td>
                        <td th:text="${r.reportType != null ? r.reportType.name : '-'}">Water Usage</td>
                        <td th:text="${r.location != null ? r.location.name : '-'}">Campus Block A</td>
                        <td th:text="${r.notes != null && !#strings.isEmpty(r.notes) ? r.notes : '-'}">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-end gap-2 mt-3">
                <a href="/" class="btn btn-outline-success">Back to Dashboard</a>
                <div sec:authorize="hasRole('ADMIN')">
                    <a href="/add-data" class="btn btn-success">Add New Report</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- simple search filter -->
<script>
    const searchInput = document.getElementById("searchInput");
    const table = document.getElementById("reportsTable");
    const rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");

    searchInput?.addEventListener("keyup", function () {
        const filter = searchInput.value.toLowerCase();
        for (let i = 0; i < rows.length; i++) {
            const text = rows[i].innerText.toLowerCase();
            // Skip the "No reports found" row if present
            if (rows[i].children.length === 1) continue;
            rows[i].style.display = text.includes(filter) ? "" : "none";
        }
    });
</script>

</body>
</html>
