<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(
        ~{::main},
        'Weekly Reports - Green Portal',
        'reports',
        'Weekly Reports',
        'Select a location'
      )}">

<main class="page-shell">

    <style>

        /* ✅ REMOVE max-width shrink – page-shell already controls alignment */
        .page-wrap{
            width: 100%;
        }

        .card-soft{
            border: 1px solid rgba(25,135,84,.18);
            border-radius: 16px;
            box-shadow: 0 12px 32px rgba(0,0,0,.06);
            background:#fff;
        }

        /* Table polishing */
        .table thead th{
            background: #ecf7f0;
            white-space: nowrap;
            font-weight: 700;
            border-bottom: 1px solid #dbeae0;
        }

        .table td, .table th{
            padding: .85rem .9rem;
            vertical-align: middle;
        }

        .badge-soft{
            background: rgba(25,135,84,.10);
            color: #146c43;
            border: 1px solid rgba(25,135,84,.20);
            font-weight: 650;
        }

        .pill{
            border-radius: 999px;
            border: 1px solid #dde7e1;
            background: #fff;
            padding: .45rem .9rem;
        }

        .table-wrap{
            border: 1px solid #e9ecef;
            border-radius: 14px;
            overflow: hidden;
        }

        .loc-block{ display:none; }
        .loc-block.active{ display:block; }
    </style>

    <div class="page-wrap">

        <!-- Header row -->
        <div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
            <div>
                <h1 class="fw-bold mb-1 pt-2">Weekly Reports</h1>
                <div class="text-muted">Select a location to view its reports</div>
            </div>

            <div class="d-flex align-items-center gap-2">
                <span class="badge rounded-pill badge-soft">
                    <i class="bi bi-calendar-week me-1"></i>
                    <span th:text="${weekStart}">2026-02-16</span> → <span th:text="${weekEnd}">2026-02-22</span>
                </span>

                <select id="locationSelect" class="form-select pill" style="min-width: 220px;">
                    <option value="Admin Block" selected>Admin Block</option>
                    <option value="Main Campus">Main Campus</option>
                    <option value="Hostel">Hostel</option>
                    <option value="Campus Garden">Campus Garden</option>
                </select>
            </div>
        </div>

        <!-- Summary cards -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="card-soft p-3 h-100">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="subtext">Total Records (This Week)</div>
                            <div class="fs-3 fw-bold" th:text="${#lists.size(reports)}">0</div>
                        </div>
                        <div class="fs-2 text-success"><i class="bi bi-clipboard-data"></i></div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card-soft p-3 h-100">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="subtext">Locations</div>
                            <div class="fs-3 fw-bold">4</div>
                        </div>
                        <div class="fs-2 text-success"><i class="bi bi-geo-alt"></i></div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card-soft p-3 h-100">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="subtext">Quick Action</div>
                            <a class="btn btn-success mt-2" href="/add-data">
                                <i class="bi bi-plus-circle me-1"></i> Add Data
                            </a>
                        </div>
                        <div class="fs-2 text-success"><i class="bi bi-lightning"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= LOCATION TABLES ======================= -->

        <!-- Admin Block -->
        <div class="card-soft p-3 loc-block" data-loc="Admin Block">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0 fw-bold"><i class="bi bi-building text-success me-1"></i> Admin Block</h5>
                <span class="badge rounded-pill badge-soft">
                    Records:
                    <span th:text="${#lists.size(reports.?[location != null and location.name == 'Admin Block'])}">0</span>
                </span>
            </div>

            <div class="table-wrap table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                    <tr>
                        <th style="width:140px;">Date</th>
                        <th>Type</th>
                        <th style="width:160px;">Value</th>
                        <th style="width:140px;">Unit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(reports.?[location != null and location.name == 'Admin Block'])}">
                        <td colspan="4" class="text-center text-muted py-4">No reports for Admin Block this week.</td>
                    </tr>

                    <tr th:each="r : ${reports.?[location != null and location.name == 'Admin Block']}">
                        <td th:text="${r.reportDate}">2026-02-17</td>
                        <td th:text="${r.reportType != null ? r.reportType.name : '-'}">Electricity</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].value != null) ? r.reportValues[0].value : '-'}">-</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].unit != null) ? r.reportValues[0].unit : '-'}">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Main Campus -->
        <div class="card-soft p-3 loc-block mt-3" data-loc="Main Campus">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0 fw-bold"><i class="bi bi-geo-alt-fill text-success me-1"></i> Main Campus</h5>
                <span class="badge rounded-pill badge-soft">
                    Records:
                    <span th:text="${#lists.size(reports.?[location != null and location.name == 'Main Campus'])}">0</span>
                </span>
            </div>

            <div class="table-wrap table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                    <tr>
                        <th style="width:140px;">Date</th>
                        <th>Type</th>
                        <th style="width:160px;">Value</th>
                        <th style="width:140px;">Unit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(reports.?[location != null and location.name == 'Main Campus'])}">
                        <td colspan="4" class="text-center text-muted py-4">No reports for Main Campus this week.</td>
                    </tr>

                    <tr th:each="r : ${reports.?[location != null and location.name == 'Main Campus']}">
                        <td th:text="${r.reportDate}">2026-02-17</td>
                        <td th:text="${r.reportType != null ? r.reportType.name : '-'}">Water</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].value != null) ? r.reportValues[0].value : '-'}">-</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].unit != null) ? r.reportValues[0].unit : '-'}">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Hostel -->
        <div class="card-soft p-3 loc-block mt-3" data-loc="Hostel">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0 fw-bold"><i class="bi bi-house-door-fill text-success me-1"></i> Hostel</h5>
                <span class="badge rounded-pill badge-soft">
                    Records:
                    <span th:text="${#lists.size(reports.?[location != null and location.name == 'Hostel'])}">0</span>
                </span>
            </div>

            <div class="table-wrap table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                    <tr>
                        <th style="width:140px;">Date</th>
                        <th>Type</th>
                        <th style="width:160px;">Value</th>
                        <th style="width:140px;">Unit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(reports.?[location != null and location.name == 'Hostel'])}">
                        <td colspan="4" class="text-center text-muted py-4">No reports for Hostel this week.</td>
                    </tr>

                    <tr th:each="r : ${reports.?[location != null and location.name == 'Hostel']}">
                        <td th:text="${r.reportDate}">2026-02-17</td>
                        <td th:text="${r.reportType != null ? r.reportType.name : '-'}">Waste</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].value != null) ? r.reportValues[0].value : '-'}">-</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].unit != null) ? r.reportValues[0].unit : '-'}">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Campus Garden -->
        <div class="card-soft p-3 loc-block mt-3 mb-4" data-loc="Campus Garden">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0 fw-bold"><i class="bi bi-tree-fill text-success me-1"></i> Campus Garden</h5>
                <span class="badge rounded-pill badge-soft">
                    Records:
                    <span th:text="${#lists.size(reports.?[location != null and location.name == 'Campus Garden'])}">0</span>
                </span>
            </div>

            <div class="table-wrap table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                    <tr>
                        <th style="width:140px;">Date</th>
                        <th>Type</th>
                        <th style="width:160px;">Value</th>
                        <th style="width:140px;">Unit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(reports.?[location != null and location.name == 'Campus Garden'])}">
                        <td colspan="4" class="text-center text-muted py-4">No reports for Campus Garden this week.</td>
                    </tr>

                    <tr th:each="r : ${reports.?[location != null and location.name == 'Campus Garden']}">
                        <td th:text="${r.reportDate}"></td>
                        <td th:text="${r.reportType != null ? r.reportType.name : '-'}">Trees</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].value != null) ? r.reportValues[0].value : '-'}">-</td>
                        <td th:text="${(r.reportValues != null and !#lists.isEmpty(r.reportValues) and r.reportValues[0].unit != null) ? r.reportValues[0].unit : '-'}">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        const select = document.getElementById("locationSelect");
        const blocks = document.querySelectorAll(".loc-block");

        function showLocation(loc){
            blocks.forEach(b => {
                b.classList.toggle("active", b.getAttribute("data-loc") === loc);
            });
        }

        showLocation(select.value);
        select.addEventListener("change", () => showLocation(select.value));
    </script>

</main>
</html>
